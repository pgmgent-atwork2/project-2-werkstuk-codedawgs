<%- include('../partials/header.ejs')%>

<section class="main">
    <h1>Select sub department:</h1>
    <select class="subDepartmentSelect" name="subDepartmentSelect">
        <option value="all">All</option>
        <% sub_departments.forEach(sub_department => { %>
            <option value=<%= sub_department.id %>>
                <%= departments[sub_department.department_id-1].title %> |
                <%= sub_department.title %>
            </option>
        <% }); %>
    </select>

    <table border="1px">
        <tr>
            <th></th>
            <th></th>
            <th colspan="2">Depolox</th>
            <th colspan="3">Manual</th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
        <tr>
            <th>Date</th>
            <% measurement_definitions.forEach(measurement_definition => { %>
                <th><%= measurement_definition.short%></th>
            <% }); %>
            <th>User</th>
            <th>Comment</th>
        </tr>
        <tr>
            <td></td>
            <% measurement_definitions.forEach(measurement_definition => { %>
                <td><%= measurement_definition.unit%></td>
            <% }); %>
            <td></td>
            <td></td>
        </tr>

        <% measurement_logs.forEach(measurement_log => { %>

                <% const measurements = JSON.parse(measurement_log.measurements) %>
                <% const date = new Date(measurement_log.measured_date) %>
                <% const options={ hour12: false, year: 'numeric' , month: '2-digit' , day: '2-digit' };%>

                <tr class="row" data-sub-department-id="<%= measurement_log.sub_department_id  %>">
                    <td><%= date.toLocaleString('en-GB', options) %>
                    </td>
                    <% for (const measurement in measurements) { %>
                        <td><%= measurements[measurement] %></td>
                    <% } %>
                    <td><%= users[measurement_log.user_id].first_name %></td>
                    <td><%= measurement_log.comment %></td>
                </tr>
        <% }); %>
    </table>

</section>

<%- include('../partials/navigation.ejs')%>